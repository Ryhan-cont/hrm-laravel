(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{UtIQ:function(t,e,a){"use strict";a.r(e);var s=a("o0o1"),n=a.n(s);function i(t,e,a,s,n,i,o){try{var r=t[i](o),l=r.value}catch(t){return void a(t)}r.done?e(l):Promise.resolve(l).then(s,n)}function o(t){return function(){var e=this,a=arguments;return new Promise((function(s,n){var o=t.apply(e,a);function r(t){i(o,s,n,r,l,"next",t)}function l(t){i(o,s,n,r,l,"throw",t)}r(void 0)}))}}var r={components:{},data:function(){return{roleData:[],moduleData:[],inputModalSt:!1,modalTitle:null,modalType:null,name:"",baseModuleData:[],errorData:{}}},mounted:function(){this.loadData()},methods:{chkdata:function(){},loadData:function(){var t=this;return o(n.a.mark((function e(){var a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("api/role/data");case 3:a=e.sent,s=a.data,t.roleData=s.role,t.baseModuleData=s.module,console.log("req",a),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),t.notificationAlert(e.t0.response),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))()},moduleGrouping:function(t){for(var e=_.cloneDeep(t),a={},s=0;e.length>s;s++)a[e[s].id]=e[s];var n={};for(s=0;this.baseModuleData.length>s;s++){var i=this.baseModuleData[s];if(a[i.id]){var o=i.module_group;if(null!=o&&""!=o&&null!=o){if(!n[o]){var r={status:!1,name:o,type:"group",data:[]};n[o]=r}1==a[i.id].status&&(n[o].status=!0),n[o].data.push(a[i.id])}else{r={name:"general - ".concat(i.id),type:"general",data:[a[i.id]]};n["general - ".concat(i.id)]=r}}}return _.values(n)},inputModal:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(this.inputModalSt=!this.inputModalSt,this.modalType=t,"new"==t)this.modalTitle="Add new role",this.name="",this.moduleData=this.moduleGrouping(_.cloneDeep(this.baseModuleData));else if("edit"==t){this.modalTitle="Edit role",this.name=e.name,this.id=e.id;var a=_.cloneDeep(this.baseModuleData),s=_.cloneDeep(e.permission),n=a.map((function(t){var e=s.filter((function(e){return e.moduleid==t.id}));if(e.length>0){t.status=!0;var a=t.subpermissions.map((function(t){var a=e[0].subpermissions.filter((function(e){return e.name==t.name}));return a.length>0?a[0]:t}));t.subpermissions=a}return t}));this.moduleData=this.moduleGrouping(_.cloneDeep(n))}},permissionChanged:function(t,e,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("group"==s){var n=this.moduleData[t].status;this.moduleData[t].data.forEach((function(t){return t.subpermissions.forEach((function(t){return t.status=n})),t.status=n}))}else if("module"==s){1==(n=this.moduleData[t].data[e].status)&&(this.moduleData[t].status=!0),this.moduleData[t].data[e].subpermissions.forEach((function(t){return t.status=n}))}else if("sub"==s){1==(n=this.moduleData[t].data[e].subpermissions[a].status)&&(this.moduleData[t].data[e].status=!0)}},createRole:function(){var t=this;return o(n.a.mark((function e(){var a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.btnDisabled=!0,e.prev=1,a={name:t.name,permission:_.flattenDeep(_.map(t.moduleData,(function(t){return t.data})))},e.next=5,axios.post("api/role/create",a);case 5:(s=e.sent)&&(t.inputModalSt=!1,t.loadData(),t.notificationAlert(s)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),t.notificationAlert(e.t0.response);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))()},updateRole:function(){var t=this;return o(n.a.mark((function e(){var a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.btnDisabled=!0,e.prev=1,a={name:t.name,permission:_.flattenDeep(_.map(t.moduleData,(function(t){return t.data}))),id:t.id},e.next=5,axios.post("api/role/update",a);case 5:(s=e.sent)&&(t.inputModalSt=!1,t.loadData(),t.notificationAlert(s)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),t.notificationAlert(e.t0.response);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))()},deleteData:function(t){this.$vs.dialog({type:"confirm",color:"danger",title:"Confirm",acceptText:"ok",text:"Are you sure, you want to delete this role?",accept:this.deleteDataProceed,parameters:t})},deleteDataProceed:function(t){var e=this;return o(n.a.mark((function a(){var s,i;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,s={id:t.id},a.next=4,axios.post("api/role/delete",s);case 4:(i=a.sent)&&(e.notificationAlert(i),e.loadData()),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),e.notificationAlert(a.t0.response);case 11:case"end":return a.stop()}}),a,null,[[0,8]])})))()}}},l=a("KHd+"),u=Object(l.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("vx-card",{attrs:{title:"Role Manager"}},[a("div",[a("div",{staticClass:"flex"},[a("div",{staticClass:"flex-auto"}),t._v(" "),a("div",[a("vs-button",{attrs:{size:"small","icon-pack":"feather",icon:"icon-plus"},on:{click:function(e){return t.inputModal("new")}}},[t._v("Add New")])],1)]),t._v(" "),a("div",{staticClass:"pt-3",staticStyle:{"min-height":"300px"}},[a("vs-table",{attrs:{pagination:"",search:"",stripe:"",data:t.roleData},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return t._l(s,(function(e,s){return a("vs-tr",{key:s},[a("vs-td",{attrs:{data:e.name}},[t._v("\r\n              "+t._s(e.name)+"\r\n            ")]),t._v(" "),a("vs-td",{attrs:{data:e.permission}},[a("div",{staticClass:"flex flex-wrap"},t._l(e.permission,(function(e,s){return 1==e.status?a("div",{key:s,staticClass:"m-1 px-2 rounded-lg bg-gray-300"},[a("div",[t._v(t._s(e.name))]),t._v(" "),t._l(e.subpermissions,(function(e,s){return 1==e.status?a("div",{key:s,staticClass:"m-1 px-2 rounded-lg bg-gray-200"},[t._v(t._s(e.title))]):t._e()}))],2):t._e()})),0)]),t._v(" "),a("vs-td",{staticStyle:{width:"60px"}},[a("div",{staticClass:"flex"},[a("div",{staticClass:"flex-auto cursor-pointer",attrs:{align:"center"},on:{click:function(a){return t.inputModal("edit",e)}}},[a("i",{staticClass:"material-icons text-lg icon align"},[t._v("edit")])]),t._v(" "),a("div",{staticClass:"flex-auto cursor-pointer",attrs:{align:"center"},on:{click:function(a){return t.deleteData(e)}}},[a("i",{staticClass:"material-icons text-lg icon align"},[t._v("delete")])])])])],1)}))}}])},[a("template",{slot:"thead"},[a("vs-th",[t._v("Name")]),t._v(" "),a("vs-th",[t._v("permissions")]),t._v(" "),a("vs-th",{staticClass:"wd-50 text-center",staticStyle:{width:"50px"}},[t._v("Action")])],1)],2)],1),t._v(" "),a("vs-popup",{attrs:{title:t.modalTitle,active:t.inputModalSt},on:{"update:active":function(e){t.inputModalSt=e}}},[a("div",{},[a("div",{on:{click:function(e){return t.moduleFlat()}}},[t._v("Load Data")]),t._v(" "),a("div",[a("vs-input",{staticClass:"w-full",attrs:{"label-placeholder":"Name"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),t.errorData.name?a("div",{staticClass:"py-1 text-sm text-red-400"},[t._v(t._s(t.errorData.name[0]))]):t._e()],1),t._v(" "),a("div",{staticClass:"font-bold text-1xl pt-3"},[t._v("Select Module")]),t._v(" "),a("div",{staticClass:"py-4 px-8"},[t.errorData.permission?a("div",{staticClass:"py-1 text-sm text-red-400"},[t._v(t._s(t.errorData.permission[0]))]):t._e(),t._v(" "),t._l(t.moduleData,(function(e,s){return a("div",{key:s,staticClass:"py-4",staticStyle:{"border-bottom":"1px solid rgb(0,0,0,.1)"}},["group"==e.type?a("div",[a("div",{staticClass:"py-2"},[a("vs-checkbox",{on:{change:function(e){return t.permissionChanged(s,0,0,"group")}},model:{value:e.status,callback:function(a){t.$set(e,"status",a)},expression:"itemData.status"}},[t._v(t._s(e.name))])],1),t._v(" "),t._l(e.data,(function(e,n){return a("div",{key:n,staticClass:"pl-5"},[a("div",{staticClass:"py-2"},[a("vs-checkbox",{on:{change:function(e){return t.permissionChanged(s,n,0,"module")}},model:{value:e.status,callback:function(a){t.$set(e,"status",a)},expression:"item.status"}},[t._v(t._s(e.name))])],1),t._v(" "),e.subpermissions?a("div",{staticClass:"pl-8"},t._l(e.subpermissions,(function(e,i){return a("div",{key:i},[a("vs-checkbox",{on:{change:function(e){return t.permissionChanged(s,n,i,"sub")}},model:{value:e.status,callback:function(a){t.$set(e,"status",a)},expression:"sub.status"}},[t._v(t._s(e.title))])],1)})),0):t._e()])}))],2):a("div",t._l(e.data,(function(e,n){return a("div",{key:n},[a("div",{staticClass:"py-2"},[a("vs-checkbox",{on:{change:function(e){return t.permissionChanged(s,n,0,"module")}},model:{value:e.status,callback:function(a){t.$set(e,"status",a)},expression:"item.status"}},[t._v(t._s(e.name))])],1),t._v(" "),e.subpermissions?a("div",{staticClass:"pl-8"},t._l(e.subpermissions,(function(e,i){return a("div",{key:i},[a("vs-checkbox",{on:{change:function(e){return t.permissionChanged(s,n,i,"sub")}},model:{value:e.status,callback:function(a){t.$set(e,"status",a)},expression:"sub.status"}},[t._v(t._s(e.title))])],1)})),0):t._e()])})),0)])}))],2)]),t._v(" "),"new"==t.modalType?a("div",{staticClass:"pt-3",attrs:{align:"right"}},[a("vs-button",{attrs:{size:"small",disabled:t.btnDisabled},on:{click:function(e){return t.createRole()}}},[t._v("Create")])],1):t._e(),t._v(" "),"edit"==t.modalType?a("div",{staticClass:"pt-3",attrs:{align:"right"}},[a("vs-button",{attrs:{size:"small",disabled:t.btnDisabled},on:{click:function(e){return t.updateRole()}}},[t._v("Update")])],1):t._e()])],1)])}),[],!1,null,null,null);e.default=u.exports}}]);